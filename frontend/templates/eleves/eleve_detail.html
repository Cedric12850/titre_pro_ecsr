{% extends 'home/base.html' %}

{% block content %}
<h1>{{ eleve.prenom }} {{ eleve.nom }}</h1>

<!-- üîπ Informations √©l√®ve -->
<section aria-labelledby="eleve-info" class="mb-4">
  <h2 id="eleve-info">Informations de l‚Äô√©l√®ve</h2>
  <dl class="row">
    <dt class="col-sm-3">Email</dt>
    <dd class="col-sm-9">{{ eleve.email|default:"Non renseign√©" }}</dd>

    <dt class="col-sm-3">T√©l√©phone</dt>
    <dd class="col-sm-9">{{ eleve.telephone|default:"Non renseign√©" }}</dd>

    <dt class="col-sm-3">Date d'inscription</dt>
    <dd class="col-sm-9">{{ eleve.date_inscription }}</dd>
  </dl>
</section>

<!-- üîπ R√©sum√© des comp√©tences -->
<section aria-labelledby="resume-competences" class="mb-4">
  <h2 id="resume-competences">R√©sum√© des comp√©tences</h2>
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-3">
    {% for comp_entry in competence_data %}
      <div class="col">
        <div class="card h-100">
          <div class="card-body text-center">
            <h5 class="card-title">{{ comp_entry.competence.numero }} - {{ comp_entry.competence.titre }}</h5>
            <span class="badge 
                  {% if comp_entry.statut == 'pas_aborde' %}bg-secondary
                  {% elif comp_entry.statut == 'aborde' %}bg-info
                  {% elif comp_entry.statut == 'en_cours' %}bg-warning text-dark
                  {% elif comp_entry.statut == 'validee' %}bg-success
                  {% else %}bg-secondary{% endif %} fs-6 px-3 py-2">
              {{ comp_entry.statut|capfirst }}
            </span>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <a href="{% url 'eleves:eleve-objectifs-update' eleve.id %}" class="btn btn-primary mt-3">Modifier les comp√©tences</a>
</section>

<!-- üîπ Progressions / Commentaires -->
<section aria-labelledby="eleve-progression" class="mb-4">
  <h2 id="eleve-progression">Progression des cours</h2>

  {% if progressions %}
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <caption class="sr-only">Fiche de suivi des cours de {{ eleve.prenom }} {{ eleve.nom }}</caption>
        <thead class="table-light">
          <tr>
            <th>Date du cours</th>
            <th>Heure</th>
            <th>Commentaire</th>
            <th>Valid√©</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for prog in progressions %}
            <tr>
              <td>{{ prog.date_cours }}</td>
              <td>{% if prog.heure_cours %}{{ prog.heure_cours|time:"H:i" }}{% else %}-{% endif %}</td>
              <td>{{ prog.commentaire|default:"Aucun commentaire"|safe }}</td>
              <td class="text-center">
                {% if prog.valide %}
                  <span class="text-success" aria-label="Valid√©">‚úÖ</span>
                {% else %}
                  <span class="text-danger" aria-label="Non valid√©">‚ùå</span>
                {% endif %}
              </td>
              <td class="text-center">
                <a href="{% url 'eleves:progression-update' eleve.id prog.id %}" class="btn btn-sm btn-warning">Modifier</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p>Aucune progression enregistr√©e pour cet √©l√®ve.</p>
  {% endif %}
</section>

<div class="mb-4">
  <a href="{% url 'eleves:progression-create' eleve.pk %}" class="btn btn-primary">Ajouter un commentaire</a>
  <a href="{% url 'eleves:eleve-progression-pdf' eleve.pk %}" class="btn btn-outline-secondary" target="_blank">T√©l√©charger en PDF</a>
</div>

{% endblock %}