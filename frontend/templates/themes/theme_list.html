{% extends 'home/base.html' %}
{% load static %}
{% load roles %}

{% block content %}
{% if user|has_any_role:"ADMIN,FORMATEUR" %}
  <h2>üé≤ Choix du th√®me et du stagiaire</h2>

  <form method="get">
    <button type="submit" name="choisir" value="1" class="btn btn-primary">
      Choisir un th√®me au hasard
    </button>
  </form>

  {% if theme_aleatoire %}
  <div class="alert alert-success mt-3">
    <strong>Th√®me choisi :</strong> {{ theme_aleatoire.number }} ‚Äî {{ theme_aleatoire.title }}
  </div>
  {% endif %} 

  <!-- Bouton pour choisir un stagiaire -->
  <form method="get" class="mb-3">
    <button type="submit" name="choisir_eleve" value="1" class="btn btn-warning mt-3">
      Choisir un stagiaire au hasard
    </button>
  </form>

  {% if eleve_aleatoire %}
    <div class="alert alert-info">
      Stagiaire choisi : 
      <strong>{{ eleve_aleatoire.prenom }} {{ eleve_aleatoire.nom }}</strong>
    </div>
  {% endif %}
{% endif %}
  <h2>Liste des 57 th√®mes</h2>

    <h3>Filtrer par cat√©gorie:</h3>
      <!-- Boutons de filtre -->
      <!-- Filtres principaux (exclusifs) -->
        <div class="btn-group mb-3" id="primary-filter" role="group">
          <button class="btn btn-outline-primary active" data-filter="*">Tous</button>
          <button class="btn btn-outline-primary" data-filter=".cat-permis">Permis</button>
          <button class="btn btn-outline-primary" data-filter=".cat-circulation">Circulation</button>
          <button class="btn btn-outline-primary" data-filter=".cat-reglementation">R√©glementation</button>
          <button class="btn btn-outline-primary" data-filter=".cat-signalisation">Signalisation</button>
          <button class="btn btn-outline-primary" data-filter=".cat-homme">Homme</button>
          <button class="btn btn-outline-primary" data-filter=".cat-vehicule">V√©hicule</button>
          <button class="btn btn-outline-primary" data-filter=".cat-psychoactif">Psychoactif</button>
          <button class="btn btn-outline-primary" data-filter=".cat-vitesse">Vitesse</button>
          <button class="btn btn-outline-primary" data-filter=".cat-partage-social">Partage social</button>
          <button class="btn btn-outline-primary" data-filter=".cat-biomecanique">Biom√©canique</button>
        </div>

    <h3>Filtrer par tags:</h3>
      <!-- Filtres secondaires (multiples combin√©s) -->
      <div class="d-flex flex-wrap gap-2 mb-3" id="secondary-filter" role="group">
        {% for categorie in categories %}
        <button class="btn btn-outline-warning" data-filter=".tag-{{ categorie.name|slugify }}">{{ categorie.name }}</button>
        {% endfor %}
        <button class="btn btn-outline-danger" id="clear-tags">D√©sactiver les tags</button>
        
        <!-- Ajoute autant de filtres secondaires que n√©cessaire -->
      </div>

      <!-- Grille des th√®mes -->
      <div class="row grid" id="theme-container">
        {% for theme in themes %}
          <div class="card col-3 m-3 element-item 
                      {% if theme.categorie %}cat-{{ theme.categorie.name|slugify }}{% endif %}
                      {% for tag in theme.tags.all %} tag-{{ tag.name|slugify }}{% endfor %}">
            <div class="card-body">
              <h5 class="card-title">{{ theme.number }}. {{ theme.title }}</h5>
              <p class="card-text">
                {% if theme.categorie %}
                  <span class="badge bg-primary">{{ theme.categorie.name }}</span>
                {% endif %}
                {% for tag in theme.tags.all %}
                  <span class="badge bg-warning">{{ tag.name }}</span>
                {% endfor %}
              </p>
              <a href="{% url 'themes:theme-detail' theme.slug %}" class="btn btn-sm btn-success">D√©tails</a>
            </div>
          </div>
        {% endfor %}
      </div>



{% endblock %}
